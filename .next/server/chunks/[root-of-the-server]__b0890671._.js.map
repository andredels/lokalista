{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 115, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Andre/Documents/GitHub/lokalista/app/api/chat/route.ts"],"sourcesContent":["\"use server\";\r\n\r\nimport { NextResponse } from \"next/server\";\r\nimport Groq from \"groq-sdk\";\r\n\r\n// Groq client will be initialized in POST handler with validated API key\r\n\r\ntype ChatMessage = {\r\n  role: \"system\" | \"user\" | \"assistant\";\r\n  content: string;\r\n};\r\n\r\nexport async function POST(request: Request) {\r\n  try {\r\n    const { messages } = await request.json();\r\n\r\n    if (!Array.isArray(messages) || messages.length === 0) {\r\n      return NextResponse.json({ error: \"Messages array is required.\" }, { status: 400 });\r\n    }\r\n\r\n    const apiKey = process.env.GROQ_API_KEY;\r\n    if (!apiKey) {\r\n      console.error(\"GROQ_API_KEY is not set in environment variables\");\r\n      return NextResponse.json({ \r\n        error: \"Groq API key is not configured. Please add GROQ_API_KEY to your .env.local file.\" \r\n      }, { status: 500 });\r\n    }\r\n\r\n    // Check if API key looks valid (starts with gsk_)\r\n    if (!apiKey.startsWith('gsk_')) {\r\n      console.error(\"GROQ_API_KEY format appears invalid (should start with 'gsk_')\");\r\n      return NextResponse.json({ \r\n        error: \"Invalid API key format. Groq API keys should start with 'gsk_'.\" \r\n      }, { status: 500 });\r\n    }\r\n\r\n    const sanitizedMessages: ChatMessage[] = messages\r\n      .filter((msg: ChatMessage) => msg && typeof msg.content === \"string\" && msg.content.trim().length > 0)\r\n      .map((msg: ChatMessage) => ({\r\n        role: msg.role,\r\n        content: msg.content.trim(),\r\n      }));\r\n\r\n    if (sanitizedMessages.length === 0) {\r\n      return NextResponse.json({ error: \"No valid messages supplied.\" }, { status: 400 });\r\n    }\r\n\r\n    // Initialize client with validated API key\r\n    const client = new Groq({\r\n      apiKey: apiKey,\r\n    });\r\n\r\n    const model = process.env.GROQ_CHAT_MODEL || \"llama-3.1-8b-instant\";\r\n\r\n    const completion = await client.chat.completions.create({\r\n      model,\r\n      messages: sanitizedMessages,\r\n      temperature: 0.7,\r\n      max_tokens: 800,\r\n      top_p: 0.9,\r\n    });\r\n\r\n    return NextResponse.json(completion);\r\n  } catch (error: any) {\r\n    console.error(\"Groq chat route error:\", error);\r\n    \r\n    // Handle specific Groq API errors\r\n    if (error?.status === 401 || error?.code === 'invalid_api_key') {\r\n      return NextResponse.json({ \r\n        error: \"Invalid API key. Please check your GROQ_API_KEY in .env.local file. Make sure it's correct and starts with 'gsk_'.\" \r\n      }, { status: 401 });\r\n    }\r\n    \r\n    if (error?.status === 429) {\r\n      return NextResponse.json({ \r\n        error: \"Rate limit exceeded. Please try again in a moment.\" \r\n      }, { status: 429 });\r\n    }\r\n    \r\n    const message =\r\n      error?.response?.data?.error?.message ||\r\n      error?.message ||\r\n      \"Unexpected error while generating chat response.\";\r\n    return NextResponse.json({ error: message }, { status: 500 });\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;;;;;AASO,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,EAAE,QAAQ,EAAE,GAAG,MAAM,QAAQ,IAAI;QAEvC,IAAI,CAAC,MAAM,OAAO,CAAC,aAAa,SAAS,MAAM,KAAK,GAAG;YACrD,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA8B,GAAG;gBAAE,QAAQ;YAAI;QACnF;QAEA,MAAM,SAAS,QAAQ,GAAG,CAAC,YAAY;QACvC,IAAI,CAAC,QAAQ;YACX,QAAQ,KAAK,CAAC;YACd,OAAO,gJAAY,CAAC,IAAI,CAAC;gBACvB,OAAO;YACT,GAAG;gBAAE,QAAQ;YAAI;QACnB;QAEA,kDAAkD;QAClD,IAAI,CAAC,OAAO,UAAU,CAAC,SAAS;YAC9B,QAAQ,KAAK,CAAC;YACd,OAAO,gJAAY,CAAC,IAAI,CAAC;gBACvB,OAAO;YACT,GAAG;gBAAE,QAAQ;YAAI;QACnB;QAEA,MAAM,oBAAmC,SACtC,MAAM,CAAC,CAAC,MAAqB,OAAO,OAAO,IAAI,OAAO,KAAK,YAAY,IAAI,OAAO,CAAC,IAAI,GAAG,MAAM,GAAG,GACnG,GAAG,CAAC,CAAC,MAAqB,CAAC;gBAC1B,MAAM,IAAI,IAAI;gBACd,SAAS,IAAI,OAAO,CAAC,IAAI;YAC3B,CAAC;QAEH,IAAI,kBAAkB,MAAM,KAAK,GAAG;YAClC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA8B,GAAG;gBAAE,QAAQ;YAAI;QACnF;QAEA,2CAA2C;QAC3C,MAAM,SAAS,IAAI,kKAAI,CAAC;YACtB,QAAQ;QACV;QAEA,MAAM,QAAQ,QAAQ,GAAG,CAAC,eAAe,IAAI;QAE7C,MAAM,aAAa,MAAM,OAAO,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC;YACtD;YACA,UAAU;YACV,aAAa;YACb,YAAY;YACZ,OAAO;QACT;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,0BAA0B;QAExC,kCAAkC;QAClC,IAAI,OAAO,WAAW,OAAO,OAAO,SAAS,mBAAmB;YAC9D,OAAO,gJAAY,CAAC,IAAI,CAAC;gBACvB,OAAO;YACT,GAAG;gBAAE,QAAQ;YAAI;QACnB;QAEA,IAAI,OAAO,WAAW,KAAK;YACzB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBACvB,OAAO;YACT,GAAG;gBAAE,QAAQ;YAAI;QACnB;QAEA,MAAM,UACJ,OAAO,UAAU,MAAM,OAAO,WAC9B,OAAO,WACP;QACF,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAQ,GAAG;YAAE,QAAQ;QAAI;IAC7D;AACF;;;IAzEsB;;AAAA,iPAAA","debugId":null}}]
}