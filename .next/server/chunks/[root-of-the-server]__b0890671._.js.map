{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 115, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Craig/Desktop/WEB%20DEV/final%20project/deployment/lokalista/app/api/chat/route.ts"],"sourcesContent":["\"use server\";\n\nimport { NextResponse } from \"next/server\";\nimport Groq from \"groq-sdk\";\n\n// Groq client will be initialized in POST handler with validated API key\n\ntype ChatMessage = {\n  role: \"system\" | \"user\" | \"assistant\";\n  content: string;\n};\n\nexport async function POST(request: Request) {\n  try {\n    const { messages } = await request.json();\n\n    if (!Array.isArray(messages) || messages.length === 0) {\n      return NextResponse.json({ error: \"Messages array is required.\" }, { status: 400 });\n    }\n\n    const apiKey = process.env.GROQ_API_KEY;\n    if (!apiKey) {\n      console.error(\"GROQ_API_KEY is not set in environment variables\");\n      return NextResponse.json({ \n        error: \"Groq API key is not configured. Please add GROQ_API_KEY to your .env.local file.\" \n      }, { status: 500 });\n    }\n\n    // Check if API key looks valid (starts with gsk_)\n    if (!apiKey.startsWith('gsk_')) {\n      console.error(\"GROQ_API_KEY format appears invalid (should start with 'gsk_')\");\n      return NextResponse.json({ \n        error: \"Invalid API key format. Groq API keys should start with 'gsk_'.\" \n      }, { status: 500 });\n    }\n\n    const sanitizedMessages: ChatMessage[] = messages\n      .filter((msg: ChatMessage) => msg && typeof msg.content === \"string\" && msg.content.trim().length > 0)\n      .map((msg: ChatMessage) => ({\n        role: msg.role,\n        content: msg.content.trim(),\n      }));\n\n    if (sanitizedMessages.length === 0) {\n      return NextResponse.json({ error: \"No valid messages supplied.\" }, { status: 400 });\n    }\n\n    // Initialize client with validated API key\n    const client = new Groq({\n      apiKey: apiKey,\n    });\n\n    const model = process.env.GROQ_CHAT_MODEL || \"llama-3.1-8b-instant\";\n\n    const completion = await client.chat.completions.create({\n      model,\n      messages: sanitizedMessages,\n      temperature: 0.7,\n      max_tokens: 800,\n      top_p: 0.9,\n    });\n\n    return NextResponse.json(completion);\n  } catch (error: any) {\n    console.error(\"Groq chat route error:\", error);\n    \n    // Handle specific Groq API errors\n    if (error?.status === 401 || error?.code === 'invalid_api_key') {\n      return NextResponse.json({ \n        error: \"Invalid API key. Please check your GROQ_API_KEY in .env.local file. Make sure it's correct and starts with 'gsk_'.\" \n      }, { status: 401 });\n    }\n    \n    if (error?.status === 429) {\n      return NextResponse.json({ \n        error: \"Rate limit exceeded. Please try again in a moment.\" \n      }, { status: 429 });\n    }\n    \n    const message =\n      error?.response?.data?.error?.message ||\n      error?.message ||\n      \"Unexpected error while generating chat response.\";\n    return NextResponse.json({ error: message }, { status: 500 });\n  }\n}\n\n"],"names":[],"mappings":";;;;;AAEA;AACA;;;;;AASO,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,EAAE,QAAQ,EAAE,GAAG,MAAM,QAAQ,IAAI;QAEvC,IAAI,CAAC,MAAM,OAAO,CAAC,aAAa,SAAS,MAAM,KAAK,GAAG;YACrD,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA8B,GAAG;gBAAE,QAAQ;YAAI;QACnF;QAEA,MAAM,SAAS,QAAQ,GAAG,CAAC,YAAY;QACvC,IAAI,CAAC,QAAQ;YACX,QAAQ,KAAK,CAAC;YACd,OAAO,gJAAY,CAAC,IAAI,CAAC;gBACvB,OAAO;YACT,GAAG;gBAAE,QAAQ;YAAI;QACnB;QAEA,kDAAkD;QAClD,IAAI,CAAC,OAAO,UAAU,CAAC,SAAS;YAC9B,QAAQ,KAAK,CAAC;YACd,OAAO,gJAAY,CAAC,IAAI,CAAC;gBACvB,OAAO;YACT,GAAG;gBAAE,QAAQ;YAAI;QACnB;QAEA,MAAM,oBAAmC,SACtC,MAAM,CAAC,CAAC,MAAqB,OAAO,OAAO,IAAI,OAAO,KAAK,YAAY,IAAI,OAAO,CAAC,IAAI,GAAG,MAAM,GAAG,GACnG,GAAG,CAAC,CAAC,MAAqB,CAAC;gBAC1B,MAAM,IAAI,IAAI;gBACd,SAAS,IAAI,OAAO,CAAC,IAAI;YAC3B,CAAC;QAEH,IAAI,kBAAkB,MAAM,KAAK,GAAG;YAClC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA8B,GAAG;gBAAE,QAAQ;YAAI;QACnF;QAEA,2CAA2C;QAC3C,MAAM,SAAS,IAAI,kKAAI,CAAC;YACtB,QAAQ;QACV;QAEA,MAAM,QAAQ,QAAQ,GAAG,CAAC,eAAe,IAAI;QAE7C,MAAM,aAAa,MAAM,OAAO,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC;YACtD;YACA,UAAU;YACV,aAAa;YACb,YAAY;YACZ,OAAO;QACT;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,0BAA0B;QAExC,kCAAkC;QAClC,IAAI,OAAO,WAAW,OAAO,OAAO,SAAS,mBAAmB;YAC9D,OAAO,gJAAY,CAAC,IAAI,CAAC;gBACvB,OAAO;YACT,GAAG;gBAAE,QAAQ;YAAI;QACnB;QAEA,IAAI,OAAO,WAAW,KAAK;YACzB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBACvB,OAAO;YACT,GAAG;gBAAE,QAAQ;YAAI;QACnB;QAEA,MAAM,UACJ,OAAO,UAAU,MAAM,OAAO,WAC9B,OAAO,WACP;QACF,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAQ,GAAG;YAAE,QAAQ;QAAI;IAC7D;AACF;;;IAzEsB;;AAAA,iPAAA","debugId":null}}]
}