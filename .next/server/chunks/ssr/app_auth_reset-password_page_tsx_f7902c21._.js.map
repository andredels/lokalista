{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/lokalista/app/auth/reset-password/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport Link from \"next/link\";\r\nimport { createClient } from \"@/lib/supabase/browserClient\";\r\nimport { useRouter, useSearchParams } from \"next/navigation\";\r\n\r\nexport default function ResetPasswordPage() {\r\n  const [password, setPassword] = useState(\"\");\r\n  const [confirmPassword, setConfirmPassword] = useState(\"\");\r\n  const [errors, setErrors] = useState<{ [k: string]: string }>({});\r\n  const [submitting, setSubmitting] = useState(false);\r\n  const [message, setMessage] = useState<string | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [validToken, setValidToken] = useState(false);\r\n  const router = useRouter();\r\n  const searchParams = useSearchParams();\r\n\r\n  useEffect(() => {\r\n    const supabase = createClient();\r\n    \r\n    const checkSession = async () => {\r\n      try {\r\n        // First, check URL hash for token (Supabase puts token in hash fragment)\r\n        const hashParams = new URLSearchParams(window.location.hash.substring(1));\r\n        const accessToken = hashParams.get('access_token');\r\n        const type = hashParams.get('type');\r\n        \r\n        if (accessToken && type === 'recovery') {\r\n          // Token is in URL, exchange it for a session\r\n          const { data: sessionData, error: sessionError } = await supabase.auth.setSession({\r\n            access_token: accessToken,\r\n            refresh_token: hashParams.get('refresh_token') || '',\r\n          });\r\n          \r\n          if (sessionError || !sessionData.session) {\r\n            setMessage(\"Invalid or expired reset link. Please request a new password reset.\");\r\n            setValidToken(false);\r\n            setLoading(false);\r\n            return;\r\n          }\r\n          \r\n          // Clear the hash from URL for cleaner UX\r\n          window.history.replaceState(null, '', window.location.pathname);\r\n          setValidToken(true);\r\n          setLoading(false);\r\n          return;\r\n        }\r\n        \r\n        // If no token in hash, check if there's already a session\r\n        const { data, error } = await supabase.auth.getSession();\r\n        \r\n        if (error) {\r\n          console.error('Error getting session:', error);\r\n          setMessage(\"Invalid or expired reset link. Please request a new password reset.\");\r\n          setLoading(false);\r\n          setValidToken(false);\r\n          return;\r\n        }\r\n        \r\n        // If there's a session, the token was already processed\r\n        if (data?.session) {\r\n          setValidToken(true);\r\n          setLoading(false);\r\n        } else {\r\n          setMessage(\"Invalid or expired reset link. Please request a new password reset.\");\r\n          setLoading(false);\r\n          setValidToken(false);\r\n        }\r\n      } catch (err) {\r\n        console.error('Error in checkSession:', err);\r\n        setMessage(\"An error occurred. Please try again.\");\r\n        setLoading(false);\r\n        setValidToken(false);\r\n      }\r\n    };\r\n\r\n    checkSession();\r\n  }, []);\r\n\r\n  async function onSubmit() {\r\n    const e: { [k: string]: string } = {};\r\n    if (password.length < 6) e.password = \"Password must be 6+ characters.\";\r\n    if (password !== confirmPassword) e.confirmPassword = \"Passwords do not match.\";\r\n    setErrors(e);\r\n    if (Object.keys(e).length !== 0) return;\r\n\r\n    setSubmitting(true);\r\n    setMessage(null);\r\n    try {\r\n      const supabase = createClient();\r\n      \r\n      // Update the password\r\n      const { error } = await supabase.auth.updateUser({\r\n        password: password,\r\n      });\r\n\r\n      if (error) {\r\n        setMessage(error.message);\r\n        return;\r\n      }\r\n\r\n      setMessage(\"Password updated successfully! Redirecting to login...\");\r\n      setTimeout(() => {\r\n        router.push(\"/auth/login\");\r\n      }, 1500);\r\n    } catch (err: any) {\r\n      setMessage(err.message || \"Failed to update password\");\r\n    } finally {\r\n      setSubmitting(false);\r\n    }\r\n  }\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center\" style={{ backgroundColor: \"#eadbfd\" }}>\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-[#8c52ff] mx-auto mb-4\"></div>\r\n          <p className=\"text-gray-600\">Verifying reset link...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!validToken) {\r\n    return (\r\n      <div className=\"min-h-screen\" style={{ backgroundColor: \"#eadbfd\" }}>\r\n        <div className=\"container py-12\">\r\n          <div className=\"min-h-[70dvh] flex items-center justify-center\">\r\n            <div className=\"w-full max-w-md\">\r\n              <div className=\"p-6 md:p-7 rounded-xl border border-border/60 bg-background shadow-sm\">\r\n                <div className=\"text-center mb-6\">\r\n                  <div className=\"inline-flex items-center gap-2 mb-4\">\r\n                    <span className=\"h-8 w-8 rounded-xl bg-gradient-to-r from-fuchsia-500 to-violet-600 grid place-items-center text-white\">\r\n                      <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" aria-hidden>\r\n                        <path d=\"M12 21s7-4.5 7-10a7 7 0 10-14 0c0 5.5 7 10 7 10z\" stroke=\"currentColor\" strokeWidth=\"1.6\"/>\r\n                        <circle cx=\"12\" cy=\"11\" r=\"2\" fill=\"currentColor\" />\r\n                      </svg>\r\n                    </span>\r\n                    <span className=\"text-lg font-semibold bg-gradient-to-r from-fuchsia-500 to-violet-600 bg-clip-text text-transparent\">Lokalista</span>\r\n                  </div>\r\n                  <h1 className=\"h1 mb-2\">Reset Link Invalid</h1>\r\n                </div>\r\n                {message && (\r\n                  <div className=\"mb-4 text-center text-sm p-3 rounded-md bg-red-50 text-red-700 border border-red-200\">\r\n                    {message}\r\n                  </div>\r\n                )}\r\n                <div className=\"text-center space-y-4\">\r\n                  <Link \r\n                    href=\"/auth/login\" \r\n                    className=\"inline-block mt-4 px-6 h-11 rounded-md bg-[#8c52ff] text-white hover:opacity-90 transition\"\r\n                  >\r\n                    Back to Login\r\n                  </Link>\r\n                  <div className=\"text-sm text-muted\">\r\n                    Need a new reset link?{\" \"}\r\n                    <Link href=\"/auth/login\" className=\"text-[#8c52ff] hover:underline underline-offset-2\">\r\n                      Request one here\r\n                    </Link>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen\" style={{ backgroundColor: \"#eadbfd\" }}>\r\n      <div className=\"container py-12\">\r\n        <div className=\"min-h-[70dvh] flex items-center justify-center\">\r\n          <div className=\"w-full max-w-md\">\r\n            <div className=\"p-6 md:p-7 rounded-xl border border-border/60 bg-background shadow-sm\">\r\n              <div className=\"text-center mb-6\">\r\n                <div className=\"inline-flex items-center gap-2 mb-4\">\r\n                  <span className=\"h-8 w-8 rounded-xl bg-gradient-to-r from-fuchsia-500 to-violet-600 grid place-items-center text-white\">\r\n                    <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" aria-hidden>\r\n                      <path d=\"M12 21s7-4.5 7-10a7 7 0 10-14 0c0 5.5 7 10 7 10z\" stroke=\"currentColor\" strokeWidth=\"1.6\"/>\r\n                      <circle cx=\"12\" cy=\"11\" r=\"2\" fill=\"currentColor\" />\r\n                    </svg>\r\n                  </span>\r\n                  <span className=\"text-lg font-semibold bg-gradient-to-r from-fuchsia-500 to-violet-600 bg-clip-text text-transparent\">Lokalista</span>\r\n                </div>\r\n                <h1 className=\"h1 mb-2\">Reset Password</h1>\r\n                <p className=\"text-muted\">Enter your new password below.</p>\r\n              </div>\r\n              <div className=\"flex flex-col gap-3\">\r\n                <label className=\"text-sm font-medium\" htmlFor=\"password\">New Password</label>\r\n                <input \r\n                  id=\"password\" \r\n                  value={password} \r\n                  onChange={(e) => setPassword(e.target.value)} \r\n                  placeholder=\"Enter new password\" \r\n                  type=\"password\" \r\n                  className=\"h-11 px-3 rounded-md border border-border/60 focus-ring\" \r\n                />\r\n                {errors.password && <div className=\"text-sm text-red-600\">{errors.password}</div>}\r\n\r\n                <label className=\"text-sm font-medium\" htmlFor=\"confirmPassword\">Confirm Password</label>\r\n                <div className=\"relative\">\r\n                  <input \r\n                    id=\"confirmPassword\" \r\n                    value={confirmPassword} \r\n                    onChange={(e) => setConfirmPassword(e.target.value)} \r\n                    placeholder=\"Confirm new password\" \r\n                    type=\"password\" \r\n                    className={`h-11 px-3 pr-10 rounded-md border focus-ring w-full ${\r\n                      confirmPassword && password !== confirmPassword \r\n                        ? 'border-red-500' \r\n                        : confirmPassword && password === confirmPassword \r\n                        ? 'border-green-500' \r\n                        : 'border-border/60'\r\n                    }`}\r\n                  />\r\n                  {confirmPassword && (\r\n                    <div className=\"absolute right-3 top-1/2 -translate-y-1/2\">\r\n                      {password === confirmPassword ? (\r\n                        <svg className=\"w-5 h-5 text-green-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\r\n                        </svg>\r\n                      ) : (\r\n                        <svg className=\"w-5 h-5 text-red-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n                        </svg>\r\n                      )}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n                {errors.confirmPassword && <div className=\"text-sm text-red-600\">{errors.confirmPassword}</div>}\r\n\r\n                <button \r\n                  onClick={onSubmit} \r\n                  disabled={submitting} \r\n                  className=\"mt-2 h-11 rounded-md bg-[#8c52ff] text-white hover:opacity-90 disabled:opacity-60\"\r\n                >\r\n                  {submitting ? \"Updating passwordâ€¦\" : \"Update Password\"}\r\n                </button>\r\n              </div>\r\n              {message && (\r\n                <div className={`mt-3 text-sm text-center p-3 rounded-md ${\r\n                  message.includes('successfully') \r\n                    ? 'bg-green-50 text-green-700 border border-green-200' \r\n                    : 'bg-red-50 text-red-700 border border-red-200'\r\n                }`}>\r\n                  {message}\r\n                </div>\r\n              )}\r\n              <div className=\"mt-5 text-sm text-center\">\r\n                Remember your password? <Link href=\"/auth/login\" className=\"underline underline-offset-4 text-[#8c52ff]\">Log in</Link>\r\n              </div>\r\n            </div>\r\n            <div className=\"mt-6 text-sm text-center\">\r\n              <Link href=\"/\" className=\"underline underline-offset-4\">Back to home</Link>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":"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","debugId":null}}]
}