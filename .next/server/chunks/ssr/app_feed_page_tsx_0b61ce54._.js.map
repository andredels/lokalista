{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Andre/Documents/GitHub/lokalista/app/feed/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useRef, useState } from \"react\";\r\n\r\n// Using CDN MapLibre to avoid local install issues\r\n// eslint-disable-next-line @next/next/no-sync-scripts\r\n// Note: Next.js app router pages can include external CSS via link tag in Head-like usage,\r\n// but inside client components we'll imperatively inject if missing.\r\n\r\nexport default function FeedMapPage() {\r\n  const mapContainerRef = useRef<HTMLDivElement | null>(null);\r\n  const mapRef = useRef<any>(null);\r\n  const userMarkerRef = useRef<any>(null);\r\n  const [locating, setLocating] = useState(false);\r\n  const [mood, setMood] = useState<string>(\"\");\r\n  const [selectedCoords, setSelectedCoords] = useState<[number, number] | null>(null);\r\n  const [styleName, setStyleName] = useState<\"streets\" | \"satellite\">(\"streets\");\r\n\r\n  useEffect(() => {\r\n    // Inject MapLibre CSS once\r\n    const existing = document.querySelector(\r\n      'link[data-maplibre-css=\"true\"]'\r\n    ) as HTMLLinkElement | null;\r\n    if (!existing) {\r\n      const link = document.createElement(\"link\");\r\n      link.rel = \"stylesheet\";\r\n      link.href = \"https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css\";\r\n      link.setAttribute(\"data-maplibre-css\", \"true\");\r\n      document.head.appendChild(link);\r\n    }\r\n\r\n    // Load script if not present\r\n    const hasScript = !!(window as any).maplibregl;\r\n    let removed = false;\r\n    const ensure = async () => {\r\n      if (!hasScript) {\r\n        await new Promise<void>((resolve) => {\r\n          const script = document.createElement(\"script\");\r\n          script.src = \"https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js\";\r\n          script.async = true;\r\n          script.onload = () => resolve();\r\n          document.body.appendChild(script);\r\n          // Cleanup marker\r\n          (script as any)._addedByUs = true;\r\n        });\r\n      }\r\n\r\n      const maplibregl = (window as any).maplibregl;\r\n      if (!mapContainerRef.current || !maplibregl) return;\r\n\r\n      // Philippines bounding box (approx): [minLng, minLat, maxLng, maxLat]\r\n      const philippinesBounds: [number, number, number, number] = [\r\n        116.0, // West of Palawan\r\n        4.5,   // South of Mindanao\r\n        127.0, // East of PH\r\n        21.5   // North of Luzon\r\n      ];\r\n\r\n      // Initial center roughly near Manila\r\n      const initialCenter: [number, number] = [121.0, 14.6];\r\n\r\n      // Create map (start with a realistic streets style; satellite available via toggle)\r\n      const MAPTILER_KEY = \"get_your_own_OpIi9ZULNHzrESv6T2vL\"; // demo key\r\n      const styles = {\r\n        streets: `https://api.maptiler.com/maps/streets-v2/style.json?key=${MAPTILER_KEY}`,\r\n        satellite: `https://api.maptiler.com/maps/hybrid/style.json?key=${MAPTILER_KEY}`,\r\n      } as const;\r\n\r\n      mapRef.current = new maplibregl.Map({\r\n        container: mapContainerRef.current,\r\n        style: styles[styleName] || \"https://demotiles.maplibre.org/style.json\",\r\n        center: initialCenter,\r\n        zoom: 5.5,\r\n        maxBounds: philippinesBounds,\r\n        attributionControl: true,\r\n      });\r\n\r\n      mapRef.current.addControl(new maplibregl.NavigationControl({ showZoom: true }));\r\n      mapRef.current.fitBounds(philippinesBounds, { padding: 40, duration: 0 });\r\n\r\n      // Add a marker at Manila as a starting point\r\n      new maplibregl.Marker().setLngLat([120.9842, 14.5995]).addTo(mapRef.current);\r\n\r\n      // Allow choosing a location by clicking (kept within PH bounds)\r\n      mapRef.current.on(\"click\", (e: any) => {\r\n        const lng = e.lngLat.lng as number;\r\n        const lat = e.lngLat.lat as number;\r\n        if (!isWithinPhilippines(lng, lat)) return;\r\n        setSelectedCoords([lng, lat]);\r\n        const gl = (window as any).maplibregl;\r\n        if (userMarkerRef.current) {\r\n          userMarkerRef.current.setLngLat([lng, lat]);\r\n        } else {\r\n          userMarkerRef.current = new gl.Marker({ color: \"#ef4444\" })\r\n            .setLngLat([lng, lat])\r\n            .addTo(mapRef.current);\r\n        }\r\n      });\r\n\r\n      // Attach helpers on window for later access\r\n      (window as any).__philippinesBounds = philippinesBounds;\r\n    };\r\n\r\n    ensure();\r\n\r\n    return () => {\r\n      // Cleanup map instance\r\n      if (mapRef.current) {\r\n        mapRef.current.remove();\r\n        mapRef.current = null;\r\n      }\r\n      // Do not remove CSS; keep for SPA navigation\r\n      // Remove script only if we added it (optional)\r\n      const scripts = Array.from(document.querySelectorAll(\"script\")) as any[];\r\n      const ours = scripts.find((s) => s._addedByUs);\r\n      if (ours && removed) {\r\n        ours.parentNode?.removeChild(ours);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  function isWithinPhilippines(lng: number, lat: number) {\r\n    const b = (window as any).__philippinesBounds as\r\n      | [number, number, number, number]\r\n      | undefined;\r\n    if (!b) return false;\r\n    return lng >= b[0] && lng <= b[2] && lat >= b[1] && lat <= b[3];\r\n  }\r\n\r\n  async function findMyLocation() {\r\n    if (!mapRef.current) return;\r\n    if (!(\"geolocation\" in navigator)) {\r\n      alert(\"Geolocation is not supported by this browser.\");\r\n      return;\r\n    }\r\n    try {\r\n      setLocating(true);\r\n      const pos = await new Promise<GeolocationPosition>((resolve, reject) => {\r\n        navigator.geolocation.getCurrentPosition(resolve, reject, {\r\n          enableHighAccuracy: true,\r\n          maximumAge: 10000,\r\n          timeout: 15000,\r\n        });\r\n      });\r\n\r\n      const lng = pos.coords.longitude;\r\n      const lat = pos.coords.latitude;\r\n\r\n      if (!isWithinPhilippines(lng, lat)) {\r\n        alert(\"Your location is outside the Philippines. Map remains scoped to PH.\");\r\n        setLocating(false);\r\n        return;\r\n      }\r\n\r\n      // Drop or move a marker to current position\r\n      const maplibregl = (window as any).maplibregl;\r\n      if (userMarkerRef.current) {\r\n        userMarkerRef.current.setLngLat([lng, lat]);\r\n      } else {\r\n        userMarkerRef.current = new maplibregl.Marker({ color: \"#8c52ff\" })\r\n          .setLngLat([lng, lat])\r\n          .addTo(mapRef.current);\r\n      }\r\n\r\n      // Center and zoom in\r\n      mapRef.current.easeTo({ center: [lng, lat], zoom: 13, duration: 800 });\r\n      setSelectedCoords([lng, lat]);\r\n    } catch (err: any) {\r\n      alert(err?.message || \"Unable to get your location.\");\r\n    } finally {\r\n      setLocating(false);\r\n    }\r\n  }\r\n\r\n  function switchStyle(name: \"streets\" | \"satellite\") {\r\n    if (!mapRef.current || styleName === name) return;\r\n    const MAPTILER_KEY = \"get_your_own_OpIi9ZULNHzrESv6T2vL\"; // demo key\r\n    const styles = {\r\n      streets: `https://api.maptiler.com/maps/streets-v2/style.json?key=${MAPTILER_KEY}`,\r\n      satellite: `https://api.maptiler.com/maps/hybrid/style.json?key=${MAPTILER_KEY}`,\r\n    } as const;\r\n    const center = mapRef.current.getCenter();\r\n    const zoom = mapRef.current.getZoom();\r\n    setStyleName(name);\r\n    mapRef.current.setStyle(styles[name], { diff: true });\r\n    mapRef.current.once(\"styledata\", () => {\r\n      mapRef.current.setCenter(center);\r\n      mapRef.current.setZoom(zoom);\r\n      const b = (window as any).__philippinesBounds;\r\n      if (b) mapRef.current.setMaxBounds(b);\r\n      const gl = (window as any).maplibregl;\r\n      if (selectedCoords) {\r\n        if (userMarkerRef.current) userMarkerRef.current.remove();\r\n        userMarkerRef.current = new gl.Marker({ color: \"#ef4444\" })\r\n          .setLngLat(selectedCoords)\r\n          .addTo(mapRef.current);\r\n      }\r\n    });\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen\" style={{ backgroundColor: \"#ffffff\" }}>\r\n      <div className=\"container py-6\">\r\n        <div className=\"mb-4 flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between\">\r\n          <div>\r\n            <h1 className=\"text-2xl font-semibold\">Philippines Map</h1>\r\n            <p className=\"text-sm text-gray-600\">Explore places limited to the Philippines.</p>\r\n          </div>\r\n          <div className=\"flex gap-3 flex-wrap\">\r\n            <div className=\"flex items-center gap-1 bg-white border border-gray-300 rounded-md p-1\">\r\n              <button onClick={() => switchStyle(\"streets\")} className={`h-8 px-3 rounded ${styleName === \"streets\" ? \"bg-gray-200\" : \"\"}`}>Streets</button>\r\n              <button onClick={() => switchStyle(\"satellite\")} className={`h-8 px-3 rounded ${styleName === \"satellite\" ? \"bg-gray-200\" : \"\"}`}>Satellite</button>\r\n            </div>\r\n            <select\r\n              aria-label=\"Select mood\"\r\n              value={mood}\r\n              onChange={(e) => setMood(e.target.value)}\r\n              className=\"h-10 px-3 rounded-md border border-gray-300\"\r\n            >\r\n              <option value=\"\">Mood: Any</option>\r\n              <option value=\"chill\">Chill</option>\r\n              <option value=\"adventurous\">Adventurous</option>\r\n              <option value=\"romantic\">Romantic</option>\r\n              <option value=\"social\">Social</option>\r\n            </select>\r\n            <button\r\n              onClick={findMyLocation}\r\n              disabled={locating}\r\n              className=\"h-10 px-4 rounded-md bg-[#8c52ff] text-white hover:opacity-90 disabled:opacity-60\"\r\n            >\r\n              {locating ? \"Locating…\" : \"Use my location\"}\r\n            </button>\r\n          </div>\r\n        </div>\r\n        {selectedCoords && (\r\n          <div className=\"mb-3 text-sm text-gray-700\">\r\n            Selected location: {selectedCoords[1].toFixed(5)}, {selectedCoords[0].toFixed(5)}\r\n          </div>\r\n        )}\r\n        <div\r\n          ref={mapContainerRef}\r\n          style={{ width: \"100%\", height: \"70vh\", borderRadius: 12, overflow: \"hidden\", border: \"1px solid #e5e7eb\" }}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n\r\n"],"names":[],"mappings":"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","debugId":null}}]
}